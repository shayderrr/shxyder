<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chill Kirb Central | Auto-Update</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Lato:wght@400;700&family=Silkscreen:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    
    <style type="text/css">
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            font-family: 'Press Start 2P', cursive;
            color: #fff;
            background-color: #ff8787;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
        }

        #kirby-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: 1;
            background: #ff8787 url('https://cdn.jsdelivr.net/gh/dino-cmxy/Kirby-Arcade-ig-idk-anymore@main/pxsprite-kirbyinspaceee.gif') no-repeat center center;
            background-size: cover;
        }

        #nav-dock {
            position: fixed; top: 25px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 12px; padding: 10px 20px;
            background: rgba(0, 0, 0, 0.7); border-radius: 30px;
            border: 2px solid rgba(255, 255, 255, 0.5); z-index: 10000;
            backdrop-filter: blur(8px);
        }

        .nav-item {
            width: 42px; height: 42px; background: rgba(255,255,255,0.1);
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            color: #fff; cursor: pointer; transition: 0.2s; position: relative;
        }

        .nav-item:hover { transform: scale(1.2); background: #ff8fab; }
        .nav-item::after {
            content: attr(data-label); position: absolute; top: 130%;
            background: #000; padding: 5px 10px; border-radius: 5px;
            font-size: 8px; white-space: nowrap; opacity: 0; pointer-events: none;
        }
        .nav-item:hover::after { opacity: 1; }

        #main-content { z-index: 2; width: 90%; max-width: 800px; text-align: center; }
        .title { font-size: 2.2em; text-shadow: 4px 4px 0px #000; margin-bottom: 30px; }
        
        .search-bar {
            width: 100%; padding: 18px 25px; border-radius: 50px;
            background: rgba(0,0,0,0.8); border: 3px solid #fff;
            color: #fff; font-family: 'Lato'; font-size: 1.2em; outline: none;
        }

        .status-pill {
            position: fixed; bottom: 20px; left: 20px;
            background: rgba(0,0,0,0.8); padding: 5px 15px;
            border-radius: 20px; font-size: 8px; font-family: 'Silkscreen';
            border: 1px solid #00ffaa; z-index: 100; color: #00ffaa;
        }

        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: #fff; color: #000; padding: 10px 20px; border: 3px solid #000;
            font-size: 10px; opacity: 0; transition: 0.3s; z-index: 10001;
        }
        .toast.show { opacity: 1; }
        .loading { cursor: wait !important; opacity: 0.5; }
    </style>
</head>
<body>

    <div id="kirby-background"></div>

    <div id="nav-dock"></div>

    <main id="main-content">
        <h1 class="title" id="typing-text"></h1>
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Enter branch name or file...">
        </div>
    </main>

    <div class="status-pill" id="sha-display">SHA: Fetching...</div>
    <div class="toast" id="toast"></div>

    <script>
        const REPO = "shayderrr/kirb";
        let currentSHA = "main"; // Fallback to main

        // 1. AUTO-UPDATE ENGINE: Get latest SHA from GitHub API
        async function updateSHA() {
            try {
                const response = await fetch(`https://api.github.com/repos/${REPO}/commits/main`);
                const data = await response.json();
                currentSHA = data.sha;
                document.getElementById('sha-display').textContent = `SHA: ${currentSHA.substring(0,7)}`;
                console.log("Latest Commit SHA:", currentSHA);
            } catch (e) {
                console.error("Failed to fetch SHA, using 'main' branch fallback.");
                document.getElementById('sha-display').textContent = "SHA: main (cached)";
            }
        }

        const navItems = [
            { icon: 'fa-gamepad', label: 'GAMES', path: 'games/gamehome.html' },
            { icon: 'fa-comments', label: 'CHATROOM', path: 'page/chatroom.html' },
            { icon: 'fa-users', label: 'STAFF', path: 'page/our-staff.html' },
            { icon: 'fa-briefcase', label: 'JOBS', path: 'page/jb.html' },
            { icon: 'fa-star', label: 'SPONSORS', path: 'page/sponsers.html' },
            { icon: 'fa-info-circle', label: 'INFO', path: 'page/info.html' }
        ];

        // 2. THE DYNAMIC LAUNCHER: Uses currentSHA for instant updates
        async function launch(path, el = null) {
            if (el) el.classList.add('loading');
            showToast(`Loading: ${path}`);

            try {
                // Construct URL using the live SHA
                let url = `https://cdn.jsdelivr.net/gh/${REPO}@${currentSHA}/${path}`;
                
                // If the path doesn't look like a file, treat it as a Branch search (for games)
                if (!path.includes('.') && !path.includes('/')) {
                    url = `https://cdn.jsdelivr.net/gh/${REPO}@${path}/index.html`;
                }

                const res = await fetch(url);
                if (!res.ok) throw new Error();

                const code = await res.text();
                const win = window.open('about:blank', '_blank');
                if (win) {
                    win.document.open();
                    win.document.write(code);
                    win.document.close();
                } else {
                    alert("Popup blocked! Allow popups to play.");
                }
            } catch (e) {
                showToast("W.I.P - FILE NOT FOUND");
            } finally {
                if (el) el.classList.remove('loading');
            }
        }

        // INIT DOCK
        function createNav() {
            const dock = document.getElementById('nav-dock');
            navItems.forEach(item => {
                const d = document.createElement('div');
                d.className = 'nav-item';
                d.dataset.label = item.label;
                d.innerHTML = `<i class="fas ${item.icon}"></i>`;
                d.onclick = () => launch(item.path, d);
                dock.appendChild(d);
            });
        }

        // SEARCH BAR
        document.querySelector('.search-bar').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const val = this.value.trim();
                if (val) launch(val);
            }
        });

        // UI UTILS
        function showToast(m) {
            const t = document.getElementById('toast');
            t.textContent = m; t.classList.add('show');
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        const messages = ["KIRBY ARCADE", "LATEST UPDATE", "CHILL VAULT", "KIRB.GG"];
        let mI = 0, cI = 0, del = false;
        function type() {
            const msg = messages[mI];
            document.getElementById('typing-text').textContent = del ? msg.substring(0, cI--) : msg.substring(0, cI++);
            if (!del && cI > msg.length) { del = true; setTimeout(type, 2000); }
            else if (del && cI < 0) { del = false; mI = (mI + 1) % messages.length; cI = 0; setTimeout(type, 500); }
            else { setTimeout(type, del ? 60 : 120); }
        }

        // STARTUP
        updateSHA().then(() => {
            createNav();
            type();
        });
    </script>
</body>
</html>
